<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
  <title>Spatnav sanity check</title>
  <script src="../../polyfill/spatial-navigation-polyfill.js"></script>

  <link rel="stylesheet" href="../../demo/sample/spatnav-style.css">
  <link rel="stylesheet" href="test.css">
  <script src="test.js"></script>
</head>
<body onload="onload()">
	<iframe src="iframe_sub.html" id="iframe-element" tabindex="0" class="container c2"></iframe>
	<div tabindex="0" class="box b1" id="b1" style="left: 70px; top: -180px;"></div>
	<div tabindex="0" class="box b1" id="b2" style="left: 180px; top: -120px;"></div>
	<div tabindex="0" class="box b1" id="b3" style="left: 20px; top: -90px;"></div>
	<div tabindex="0" class="box b1" id="b4" style="left: 190px; top: -50px;"></div>
</body>

  <script>
  var onload = () => {
    const iframeElement = document.querySelector('#iframe-element');
    testInit();

    testRun(function() {
      document.querySelector('#b4').focus();
      window.navigate('up');
      assert_equals(document.activeElement, iframeElement);
      window.navigate('up');
      assert_equals(document.activeElement, document.querySelector('#iframe-element'));
      assert_equals(iframeElement.contentDocument.activeElement, iframeElement.contentDocument.querySelector('#sub-b4'));
    }, "iframe TC1. b4 button -> navigate('up') -> next Target should be iframe element");

    testRun(function() {
      iframeElement.contentDocument.querySelector('#sub-b8').focus();
      var e = new KeyboardEvent("keydown", {bubbles : true, cancelable : true, keyCode : 40});
      iframeElement.contentDocument.dispatchEvent(e);
      assert_equals(document.activeElement, document.querySelector('#b4'));
    }, "iframe TC2. #sub-b8 button -> navigate('down') -> next Target should be #b4 element");

    testRun(function() {
      iframeElement.contentDocument.querySelector('#sub-b8').focus();
      let e = new KeyboardEvent("keydown", {bubbles : true, cancelable : true, keyCode : 40});
      iframeElement.contentDocument.dispatchEvent(e);
      window.navigate('down');
      window.navigate('down');
      assert_not_equals(document.activeElement, iframeElement);
      assert_equals(document.activeElement, document.querySelector('#b4'));
    }, "iframe TC3. iframe -> iterate 'down' key -> focus should escape from iframe");
  }
  </script>
</html>
